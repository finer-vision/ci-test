jobs:
  include:
    - stage: php
      language: php
      php: 7.2
      before_script:
        - cp .env.example .env
        - composer self-update
        - composer install --prefer-source --no-interaction
        - php artisan key:generate
      script:
        - echo "Finished PHP"

    - stage: node_js
      language: node_js
      node_js: 12.13
      before_script:
        - npm ci
        - npm run build
      script:
        - echo "Finished NodeJS"
      cache:
        directories:
          - "$HOME/.npm"

    - stage: deploy
      script:
        - openssl aes-256-cbc -K $encrypted_03302a942c69_key -iv $encrypted_03302a942c69_iv
        - in TravisCIDeployKey.enc -out TravisCIDeployKey -d
        - scp -i TravisCIDeployKey -r ./ root@katie.finervision.com:~/.travis-builds/$TRAVIS_BUILD_ID

    stages:
      - php
      - node_js
      - deploy

notifications:
  email: false
